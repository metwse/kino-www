<script>
    const deck = root.querySelector("kino-deck");
    const done = root.querySelector(".done");

    var cards = await window.session.home();
    deck.freeMode = false;

    deck.addCards(cards);
    deck.init();

    const updateProgress = _ => {
        let cardsDone = window.session.cardsDone;
        let totalCards = window.session.cardCount;
        root.querySelector(".progress").innerText = `${cardsDone}/${totalCards}`;
        let deckLevel = deck.currentCard?.data?.deck?.level;
        root.querySelector(".deck-name").innerText =
            deckLevel !== undefined ? `deck ${deckLevel + 1}` : "all cards are done";

        if (cardsDone == totalCards && !deck.freeMode)
            done.style.display = "";
    }

    done.querySelector("button").onclick = async _ => {
        deck.freeMode = true;
        let home = await window.session.home(true);
        deck.addCards(cards);
        deck.init();
        done.style.display = "none";
    }

    deck.eventHandler = async ({ action, cardsLeft }) => {
        if (cardsLeft < 2) {
            var cards = (await window.session.home(deck.freeMode))
                .filter(card => !deck.cards.find(loadedCard => card == loadedCard));
            deck.addCards(cards);
        }
        deck.loadNextCard();
        updateProgress();
    }
    console.log(deck.currentCard);
    updateProgress();
</script>

<nav>
    <span class="progress">n/m</span>
    <span class="deck-name">deck 1</span>
</nav>
<div class="main">
    <kino-deck class="deck"></kino-deck>
    <div class="done" style="display: none;">
        <span>Recurring cards are done.</span>
        <button>practice freely</button>
    </div>
</div>


<style>
    :host {
        display: flex;
        padding: 0 !important;
        flex-direction: column;
    }

    nav {
        display: flex;
        padding: 1em 2em 0;
        justify-content: space-between;
    }

    .main { 
        display: grid; 
        padding: 1em;
        flex-grow: 1; 
    }

    .main > * {
        grid-area: 1 / 1 / 2 / 2
    }

    .done {
        display: flex;
        flex-direction: column;
        justify-content: center; align-items: center;
        gap: 1em;
        z-index: 2;

        span { font-size: 1.25em; }
    }
</style>
