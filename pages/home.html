<script>
    let home = await window.session.home();
    let freeMode = false;

    function updateProgress(n, m) {
        root.querySelector(".progress").innerHTML = `${n}/${m}`;

        if (home.done == home.total) 
            root.querySelector(".done").style.display = "";
    }

    let deck = root.querySelector("kino-deck");

    deck.addCards(home.cards)
    deck.next()

    let startX = 0;
    let movement = 0;
    deck.addEventListener("touchstart", ({ changedTouches: [touch] }) => {
        startX = touch.screenX;
    });

    deck.addEventListener("touchmove", async ({ changedTouches: [touch] }) => {
        movement = touch.screenX - startX;
        if (Math.abs(movement) > 10) {
            if (movement > 0) movement -= 10;
            else movement += 10;
            deck.card.style.transform = `translateX(${movement}px)`
            if (Math.abs(movement) >= 54) await deck.next(movement > 0, !freeMode)
        }
    });
    deck.addEventListener("touchend", async _ => {
        if (Math.abs(movement) < 54) deck.card.style.transform = `translateX(0)`
        else await deck.next(movement > 0, !freeMode)
    })

    updateProgress(home.done, home.total);
</script>

<nav>
    <span class="progress">n/m</span>
    <span class="deck-name">deck 1</span>
</nav>
<div class="main">
    <div class="done" style="display: none;">
        <span>Recurring cards are done.</span>
        <button>practice freely</button>
    </div>
    <kino-deck class="deck"></kino-deck>
</div>


<style>
    :host {
        display: flex;
        padding: 0 !important;
        flex-direction: column;
    }

    nav {
        display: flex;
        padding: 1em 2em 0;
        justify-content: space-between;
    }

    .main { 
        display: grid; 
        padding: 1em;
        flex-grow: 1; 
    }

    .main > * {
        grid-area: 1 / 1 / 2 / 2
    }

    .done {
        display: flex;
        flex-direction: column;
        justify-content: center; align-items: center;
        gap: 1em;

        span { font-size: 1.25em; }
    }
</style>
